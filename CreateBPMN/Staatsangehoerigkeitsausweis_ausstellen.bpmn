<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions
  xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL"
  xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI"
  xmlns:dc="http://www.omg.org/spec/DD/20100524/DC"
  xmlns:di="http://www.omg.org/spec/DD/20100524/DI"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:camunda="http://camunda.org/schema/1.0/bpmn"
  targetNamespace="http://example.com/bpmn/staatsangehoerigkeitsausweis"
  exporter="GitHub-Copilot-GovModeler"
  exporterVersion="2.0"
  modeler:executionPlatform="Camunda Platform"
  modeler:executionPlatformVersion="7.20.0">

  <!-- Kollaboration: Staatsangehoerigkeitsausweis ausstellen (Happy Path) -->
  <bpmn:collaboration id="Collab_Staatsangehoerigkeitsausweis_ausstellen" name="Staatsangehoerigkeitsausweis ausstellen">
    <bpmn:participant id="Participant_Buerger" name="Buerger" processRef="Process_Buerger" />
    <bpmn:participant id="Participant_IT" name="IT" processRef="Process_IT" />
    <bpmn:participant id="Participant_Behoerde" name="Behoerde" processRef="Process_Behoerde" />

    <!-- Message Flows (nur Happy Path) -->
    <bpmn:messageFlow id="MsgFlow_Antrag_Nachweise" name="Antrag und Nachweise" sourceRef="Task_Nachweise_hochladen" targetRef="StartEvent_IT" />
    <bpmn:messageFlow id="MsgFlow_Antragsdaten" name="Antragsdaten" sourceRef="Task_Antrag_erfassen" targetRef="StartEvent_Behoerde" />
    <bpmn:messageFlow id="MsgFlow_Registerauskunft" name="Registerauskunft" sourceRef="Task_Registerdaten_anfragen" targetRef="Event_Registerauskunft_erhalten" />
    <bpmn:messageFlow id="MsgFlow_Freigabe" name="Freigabe" sourceRef="Task_Freigabe_erteilen" targetRef="Event_Freigabe_erhalten" />
    <bpmn:messageFlow id="MsgFlow_Bescheid" name="Bescheid" sourceRef="Task_Ausweis_bereitstellen" targetRef="Event_Bescheid_erhalten" />
  </bpmn:collaboration>

  <!-- Prozess: Buerger -->
  <bpmn:process id="Process_Buerger" name="Staatsangehoerigkeitsausweis_Buerger" isExecutable="true">
    <bpmn:startEvent id="StartEvent_Buerger" name="Antrag eingegangen">
      <bpmn:outgoing>Flow_Buerger_Start_Antrag</bpmn:outgoing>
    </bpmn:startEvent>

    <bpmn:userTask id="Task_Antrag_stellen" name="Antrag digital stellen" camunda:formKey="embedded:app:forms/Staatsangehoerigkeitsausweis_Antrag.form">
      <bpmn:incoming>Flow_Buerger_Start_Antrag</bpmn:incoming>
      <bpmn:outgoing>Flow_Buerger_Antrag_Nachweise</bpmn:outgoing>
    </bpmn:userTask>

    <bpmn:userTask id="Task_Nachweise_hochladen" name="Nachweise hochladen">
      <bpmn:incoming>Flow_Buerger_Antrag_Nachweise</bpmn:incoming>
      <bpmn:outgoing>Flow_Buerger_Warten_Bescheid</bpmn:outgoing>
    </bpmn:userTask>

    <bpmn:intermediateCatchEvent id="Event_Bescheid_erhalten" name="Bescheid erhalten">
      <bpmn:incoming>Flow_Buerger_Warten_Bescheid</bpmn:incoming>
      <bpmn:outgoing>Flow_Buerger_Bescheid_Ende</bpmn:outgoing>
      <bpmn:messageEventDefinition id="MessageEventDef_Bescheid" messageRef="Message_Bescheid" />
    </bpmn:intermediateCatchEvent>

    <bpmn:endEvent id="EndEvent_Buerger" name="Staatsangehoerigkeitsausweis ausgestellt">
      <bpmn:incoming>Flow_Buerger_Bescheid_Ende</bpmn:incoming>
    </bpmn:endEvent>

    <bpmn:sequenceFlow id="Flow_Buerger_Start_Antrag" sourceRef="StartEvent_Buerger" targetRef="Task_Antrag_stellen" />
    <bpmn:sequenceFlow id="Flow_Buerger_Antrag_Nachweise" sourceRef="Task_Antrag_stellen" targetRef="Task_Nachweise_hochladen" />
    <bpmn:sequenceFlow id="Flow_Buerger_Warten_Bescheid" sourceRef="Task_Nachweise_hochladen" targetRef="Event_Bescheid_erhalten" />
    <bpmn:sequenceFlow id="Flow_Buerger_Bescheid_Ende" sourceRef="Event_Bescheid_erhalten" targetRef="EndEvent_Buerger" />
  </bpmn:process>

  <!-- Prozess: IT -->
  <bpmn:process id="Process_IT" name="Staatsangehoerigkeitsausweis_IT" isExecutable="true">
    <bpmn:startEvent id="StartEvent_IT" name="Antrag und Nachweise empfangen">
      <bpmn:outgoing>Flow_IT_Start_Erfassen</bpmn:outgoing>
    </bpmn:startEvent>

    <bpmn:serviceTask id="Task_Antrag_erfassen" name="Antrag erfassen und weiterleiten">
      <bpmn:incoming>Flow_IT_Start_Erfassen</bpmn:incoming>
      <bpmn:outgoing>Flow_IT_Erfassen_Register</bpmn:outgoing>
    </bpmn:serviceTask>

    <bpmn:serviceTask id="Task_Registerdaten_anfragen" name="Registerdaten anfragen">
      <bpmn:incoming>Flow_IT_Erfassen_Register</bpmn:incoming>
      <bpmn:outgoing>Flow_IT_Warten_Freigabe</bpmn:outgoing>
    </bpmn:serviceTask>

    <bpmn:intermediateCatchEvent id="Event_Freigabe_erhalten" name="Freigabe erhalten">
      <bpmn:incoming>Flow_IT_Warten_Freigabe</bpmn:incoming>
      <bpmn:outgoing>Flow_IT_Freigabe_Erzeugen</bpmn:outgoing>
      <bpmn:messageEventDefinition id="MessageEventDef_Freigabe" messageRef="Message_Freigabe" />
    </bpmn:intermediateCatchEvent>

    <bpmn:serviceTask id="Task_Ausweis_erzeugen" name="Ausweis digital erzeugen">
      <bpmn:incoming>Flow_IT_Freigabe_Erzeugen</bpmn:incoming>
      <bpmn:outgoing>Flow_IT_Erzeugen_Ende</bpmn:outgoing>
    </bpmn:serviceTask>

    <bpmn:endEvent id="EndEvent_IT" name="Ausweis erzeugt">
      <bpmn:incoming>Flow_IT_Erzeugen_Ende</bpmn:incoming>
    </bpmn:endEvent>

    <bpmn:sequenceFlow id="Flow_IT_Start_Erfassen" sourceRef="StartEvent_IT" targetRef="Task_Antrag_erfassen" />
    <bpmn:sequenceFlow id="Flow_IT_Erfassen_Register" sourceRef="Task_Antrag_erfassen" targetRef="Task_Registerdaten_anfragen" />
    <bpmn:sequenceFlow id="Flow_IT_Warten_Freigabe" sourceRef="Task_Registerdaten_anfragen" targetRef="Event_Freigabe_erhalten" />
    <bpmn:sequenceFlow id="Flow_IT_Freigabe_Erzeugen" sourceRef="Event_Freigabe_erhalten" targetRef="Task_Ausweis_erzeugen" />
    <bpmn:sequenceFlow id="Flow_IT_Erzeugen_Ende" sourceRef="Task_Ausweis_erzeugen" targetRef="EndEvent_IT" />
  </bpmn:process>

  <!-- Prozess: Behoerde -->
  <bpmn:process id="Process_Behoerde" name="Staatsangehoerigkeitsausweis_Behoerde" isExecutable="true">
    <bpmn:startEvent id="StartEvent_Behoerde" name="Antragsdaten eingegangen">
      <bpmn:outgoing>Flow_Behoerde_Warten_Register</bpmn:outgoing>
    </bpmn:startEvent>

    <bpmn:intermediateCatchEvent id="Event_Registerauskunft_erhalten" name="Registerauskunft erhalten">
      <bpmn:incoming>Flow_Behoerde_Warten_Register</bpmn:incoming>
      <bpmn:outgoing>Flow_Behoerde_Pruefen</bpmn:outgoing>
      <bpmn:messageEventDefinition id="MessageEventDef_Register" messageRef="Message_Registerauskunft" />
    </bpmn:intermediateCatchEvent>

    <bpmn:userTask id="Task_Antrag_pruefen" name="Antrag fachlich pruefen" camunda:formKey="embedded:app:forms/Staatsangehoerigkeitsausweis_Pruefung.form">
      <bpmn:incoming>Flow_Behoerde_Pruefen</bpmn:incoming>
      <bpmn:outgoing>Flow_Behoerde_Entscheidung</bpmn:outgoing>
    </bpmn:userTask>

    <bpmn:userTask id="Task_Freigabe_erteilen" name="Entscheidung treffen und Freigabe erteilen">
      <bpmn:incoming>Flow_Behoerde_Entscheidung</bpmn:incoming>
      <bpmn:outgoing>Flow_Behoerde_Bereitstellen</bpmn:outgoing>
    </bpmn:userTask>

    <bpmn:userTask id="Task_Ausweis_bereitstellen" name="Ausweis bereitstellen und Bescheid uebermitteln">
      <bpmn:incoming>Flow_Behoerde_Bereitstellen</bpmn:incoming>
      <bpmn:outgoing>Flow_Behoerde_Ende</bpmn:outgoing>
    </bpmn:userTask>

    <bpmn:endEvent id="EndEvent_Behoerde" name="Staatsangehoerigkeitsausweis ausgestellt">
      <bpmn:incoming>Flow_Behoerde_Ende</bpmn:incoming>
    </bpmn:endEvent>

    <bpmn:sequenceFlow id="Flow_Behoerde_Warten_Register" sourceRef="StartEvent_Behoerde" targetRef="Event_Registerauskunft_erhalten" />
    <bpmn:sequenceFlow id="Flow_Behoerde_Pruefen" sourceRef="Event_Registerauskunft_erhalten" targetRef="Task_Antrag_pruefen" />
    <bpmn:sequenceFlow id="Flow_Behoerde_Entscheidung" sourceRef="Task_Antrag_pruefen" targetRef="Task_Freigabe_erteilen" />
    <bpmn:sequenceFlow id="Flow_Behoerde_Bereitstellen" sourceRef="Task_Freigabe_erteilen" targetRef="Task_Ausweis_bereitstellen" />
    <bpmn:sequenceFlow id="Flow_Behoerde_Ende" sourceRef="Task_Ausweis_bereitstellen" targetRef="EndEvent_Behoerde" />
  </bpmn:process>

  <!-- Messages -->
  <bpmn:message id="Message_Bescheid" name="Bescheid" />
  <bpmn:message id="Message_Registerauskunft" name="Registerauskunft" />
  <bpmn:message id="Message_Freigabe" name="Freigabe" />

  <!-- =====================================================
       BPMN-DI
       ===================================================== -->
  <bpmndi:BPMNDiagram id="BPMNDiagram_Staatsangehoerigkeitsausweis">
    <bpmndi:BPMNPlane id="BPMNPlane_Staatsangehoerigkeitsausweis" bpmnElement="Collab_Staatsangehoerigkeitsausweis_ausstellen">

      <!-- Pool: Buerger (y=80) -->
      <bpmndi:BPMNShape id="Participant_Buerger_di" bpmnElement="Participant_Buerger" isHorizontal="true">
        <dc:Bounds x="160" y="80" width="1200" height="250" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="170" y="190" width="20" height="50" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="StartEvent_Buerger_di" bpmnElement="StartEvent_Buerger">
        <dc:Bounds x="222" y="182" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Task_Antrag_stellen_di" bpmnElement="Task_Antrag_stellen">
        <dc:Bounds x="310" y="160" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Task_Nachweise_hochladen_di" bpmnElement="Task_Nachweise_hochladen">
        <dc:Bounds x="470" y="160" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_Bescheid_erhalten_di" bpmnElement="Event_Bescheid_erhalten">
        <dc:Bounds x="632" y="182" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="EndEvent_Buerger_di" bpmnElement="EndEvent_Buerger">
        <dc:Bounds x="732" y="182" width="36" height="36" />
      </bpmndi:BPMNShape>

      <bpmndi:BPMNEdge id="Flow_Buerger_Start_Antrag_di" bpmnElement="Flow_Buerger_Start_Antrag">
        <di:waypoint x="258" y="200" />
        <di:waypoint x="310" y="200" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_Buerger_Antrag_Nachweise_di" bpmnElement="Flow_Buerger_Antrag_Nachweise">
        <di:waypoint x="410" y="200" />
        <di:waypoint x="470" y="200" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_Buerger_Warten_Bescheid_di" bpmnElement="Flow_Buerger_Warten_Bescheid">
        <di:waypoint x="570" y="200" />
        <di:waypoint x="632" y="200" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_Buerger_Bescheid_Ende_di" bpmnElement="Flow_Buerger_Bescheid_Ende">
        <di:waypoint x="668" y="200" />
        <di:waypoint x="732" y="200" />
      </bpmndi:BPMNEdge>

      <!-- Pool: IT (y=370) -->
      <bpmndi:BPMNShape id="Participant_IT_di" bpmnElement="Participant_IT" isHorizontal="true">
        <dc:Bounds x="160" y="370" width="1200" height="250" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="170" y="480" width="20" height="20" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="StartEvent_IT_di" bpmnElement="StartEvent_IT">
        <dc:Bounds x="222" y="477" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Task_Antrag_erfassen_di" bpmnElement="Task_Antrag_erfassen">
        <dc:Bounds x="310" y="455" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Task_Registerdaten_anfragen_di" bpmnElement="Task_Registerdaten_anfragen">
        <dc:Bounds x="470" y="455" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_Freigabe_erhalten_di" bpmnElement="Event_Freigabe_erhalten">
        <dc:Bounds x="632" y="477" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Task_Ausweis_erzeugen_di" bpmnElement="Task_Ausweis_erzeugen">
        <dc:Bounds x="730" y="455" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="EndEvent_IT_di" bpmnElement="EndEvent_IT">
        <dc:Bounds x="892" y="477" width="36" height="36" />
      </bpmndi:BPMNShape>

      <bpmndi:BPMNEdge id="Flow_IT_Start_Erfassen_di" bpmnElement="Flow_IT_Start_Erfassen">
        <di:waypoint x="258" y="495" />
        <di:waypoint x="310" y="495" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_IT_Erfassen_Register_di" bpmnElement="Flow_IT_Erfassen_Register">
        <di:waypoint x="410" y="495" />
        <di:waypoint x="470" y="495" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_IT_Warten_Freigabe_di" bpmnElement="Flow_IT_Warten_Freigabe">
        <di:waypoint x="570" y="495" />
        <di:waypoint x="632" y="495" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_IT_Freigabe_Erzeugen_di" bpmnElement="Flow_IT_Freigabe_Erzeugen">
        <di:waypoint x="668" y="495" />
        <di:waypoint x="730" y="495" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_IT_Erzeugen_Ende_di" bpmnElement="Flow_IT_Erzeugen_Ende">
        <di:waypoint x="830" y="495" />
        <di:waypoint x="892" y="495" />
      </bpmndi:BPMNEdge>

      <!-- Pool: Behoerde (y=660) -->
      <bpmndi:BPMNShape id="Participant_Behoerde_di" bpmnElement="Participant_Behoerde" isHorizontal="true">
        <dc:Bounds x="160" y="660" width="1200" height="300" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="170" y="790" width="20" height="80" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="StartEvent_Behoerde_di" bpmnElement="StartEvent_Behoerde">
        <dc:Bounds x="222" y="782" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_Registerauskunft_erhalten_di" bpmnElement="Event_Registerauskunft_erhalten">
        <dc:Bounds x="310" y="782" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Task_Antrag_pruefen_di" bpmnElement="Task_Antrag_pruefen">
        <dc:Bounds x="408" y="760" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Task_Freigabe_erteilen_di" bpmnElement="Task_Freigabe_erteilen">
        <dc:Bounds x="568" y="760" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Task_Ausweis_bereitstellen_di" bpmnElement="Task_Ausweis_bereitstellen">
        <dc:Bounds x="728" y="760" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="EndEvent_Behoerde_di" bpmnElement="EndEvent_Behoerde">
        <dc:Bounds x="892" y="782" width="36" height="36" />
      </bpmndi:BPMNShape>

      <bpmndi:BPMNEdge id="Flow_Behoerde_Warten_Register_di" bpmnElement="Flow_Behoerde_Warten_Register">
        <di:waypoint x="258" y="800" />
        <di:waypoint x="310" y="800" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_Behoerde_Pruefen_di" bpmnElement="Flow_Behoerde_Pruefen">
        <di:waypoint x="346" y="800" />
        <di:waypoint x="408" y="800" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_Behoerde_Entscheidung_di" bpmnElement="Flow_Behoerde_Entscheidung">
        <di:waypoint x="508" y="800" />
        <di:waypoint x="568" y="800" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_Behoerde_Bereitstellen_di" bpmnElement="Flow_Behoerde_Bereitstellen">
        <di:waypoint x="668" y="800" />
        <di:waypoint x="728" y="800" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_Behoerde_Ende_di" bpmnElement="Flow_Behoerde_Ende">
        <di:waypoint x="828" y="800" />
        <di:waypoint x="892" y="800" />
      </bpmndi:BPMNEdge>

      <!-- Message Flow DI -->
      <bpmndi:BPMNEdge id="MsgFlow_Antrag_Nachweise_di" bpmnElement="MsgFlow_Antrag_Nachweise">
        <di:waypoint x="520" y="240" />
        <di:waypoint x="520" y="340" />
        <di:waypoint x="240" y="340" />
        <di:waypoint x="240" y="477" />
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="MsgFlow_Antragsdaten_di" bpmnElement="MsgFlow_Antragsdaten">
        <di:waypoint x="360" y="535" />
        <di:waypoint x="360" y="640" />
        <di:waypoint x="240" y="640" />
        <di:waypoint x="240" y="782" />
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="MsgFlow_Registerauskunft_di" bpmnElement="MsgFlow_Registerauskunft">
        <di:waypoint x="520" y="535" />
        <di:waypoint x="520" y="640" />
        <di:waypoint x="328" y="640" />
        <di:waypoint x="328" y="782" />
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="MsgFlow_Freigabe_di" bpmnElement="MsgFlow_Freigabe">
        <di:waypoint x="618" y="760" />
        <di:waypoint x="618" y="640" />
        <di:waypoint x="650" y="640" />
        <di:waypoint x="650" y="513" />
      </bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="MsgFlow_Bescheid_di" bpmnElement="MsgFlow_Bescheid">
        <di:waypoint x="778" y="760" />
        <di:waypoint x="778" y="640" />
        <di:waypoint x="650" y="640" />
        <di:waypoint x="650" y="340" />
        <di:waypoint x="650" y="218" />
      </bpmndi:BPMNEdge>

    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>

</bpmn:definitions>
