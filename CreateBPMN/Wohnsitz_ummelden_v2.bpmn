<?xml version="1.0" encoding="UTF-8"?>
<definitions 
    xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL" 
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
    xmlns:camunda="http://camunda.org/schema/1.0/bpmn" 
    xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" 
    xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" 
    xmlns:di="http://www.omg.org/spec/DD/20100524/DI" 
    targetNamespace="" 
    exporter="d.velop process modeler" 
    exporterVersion="1.0.0">

  <!-- Collaboration für Multi-Pool-Prozess -->
  <collaboration id="collaboration_wohnsitz_ummelden_v2">
    <participant id="participant_buerger" name="Bürger" processRef="process_buerger" />
    <participant id="participant_einwohnermeldeamt" name="Einwohnermeldeamt" processRef="process_einwohnermeldeamt" />
    
    <!-- Nachrichtenflüsse zwischen Pools -->
    <messageFlow id="message_flow_1" name="Ummeldungsantrag absenden" sourceRef="task_buerger_absenden" targetRef="task_amt_empfangen" />
    <messageFlow id="message_flow_2" name="Meldebestätigung bereitstellen" sourceRef="task_amt_versenden" targetRef="task_buerger_benachrichtigung" />
  </collaboration>

  <!-- Prozess: Bürger -->
  <process id="process_buerger" name="Bürger-Prozess" isExecutable="true">
    <extensionElements>
      <camunda:properties>
        <camunda:property name="variable:bisherige_adresse*" value="String!" />
        <camunda:property name="variable:neue_adresse*" value="String!" />
        <camunda:property name="variable:einzugsdatum*" value="Date!" />
        <camunda:property name="variable:wohnungsgeberbestaetigung" value="String" />
        <camunda:property name="variable:meldebestaetigung" value="String" />
      </camunda:properties>
    </extensionElements>

    <startEvent id="start_buerger" name="Wohnsitzwechsel erfolgt" />
    
    <userTask id="task_buerger_portal" 
              name="Online-Portal aufrufen und authentifizieren" 
              camunda:formKey="f8a3c2b5-9d4e-4f1a-8c6b-7e2d5a9f3c1e"
              camunda:candidateUsers="${variables.get('dv_initiator')}" 
              camunda:priority="50" />
    
    <userTask id="task_buerger_dienst" 
              name="Dienstleistung 'Wohnsitz ummelden' auswählen" 
              camunda:candidateUsers="${variables.get('dv_initiator')}" 
              camunda:priority="50" />
    
    <userTask id="task_buerger_adressen" 
              name="Bisherige und neue Wohnadresse eintragen" 
              camunda:candidateUsers="${variables.get('dv_initiator')}" 
              camunda:priority="50" />
    
    <userTask id="task_buerger_datum" 
              name="Datum des Einzugs angeben" 
              camunda:candidateUsers="${variables.get('dv_initiator')}" 
              camunda:priority="50" />
    
    <userTask id="task_buerger_upload" 
              name="Wohnungsgeberbestätigung hochladen" 
              camunda:candidateUsers="${variables.get('dv_initiator')}" 
              camunda:priority="50" />
    
    <userTask id="task_buerger_pruefen" 
              name="Eingaben auf Richtigkeit und Vollständigkeit prüfen" 
              camunda:candidateUsers="${variables.get('dv_initiator')}" 
              camunda:priority="50" />
    
    <userTask id="task_buerger_absenden" 
              name="Datenerfassung bestätigen und Antrag absenden" 
              camunda:candidateUsers="${variables.get('dv_initiator')}" 
              camunda:priority="50" />
    
    <userTask id="task_buerger_benachrichtigung" 
              name="Benachrichtigung über Abschluss empfangen" 
              camunda:candidateUsers="${variables.get('dv_initiator')}" 
              camunda:priority="50" />
    
    <userTask id="task_buerger_download" 
              name="Meldebestätigung herunterladen und speichern" 
              camunda:candidateUsers="${variables.get('dv_initiator')}" 
              camunda:priority="50" />
    
    <endEvent id="end_buerger" name="Wohnsitz erfolgreich umgemeldet" />
    
    <sequenceFlow id="flow_buerger_1" sourceRef="start_buerger" targetRef="task_buerger_portal" />
    <sequenceFlow id="flow_buerger_2" sourceRef="task_buerger_portal" targetRef="task_buerger_dienst" />
    <sequenceFlow id="flow_buerger_3" sourceRef="task_buerger_dienst" targetRef="task_buerger_adressen" />
    <sequenceFlow id="flow_buerger_4" sourceRef="task_buerger_adressen" targetRef="task_buerger_datum" />
    <sequenceFlow id="flow_buerger_5" sourceRef="task_buerger_datum" targetRef="task_buerger_upload" />
    <sequenceFlow id="flow_buerger_6" sourceRef="task_buerger_upload" targetRef="task_buerger_pruefen" />
    <sequenceFlow id="flow_buerger_7" sourceRef="task_buerger_pruefen" targetRef="task_buerger_absenden" />
    <sequenceFlow id="flow_buerger_8" sourceRef="task_buerger_absenden" targetRef="task_buerger_benachrichtigung" />
    <sequenceFlow id="flow_buerger_9" sourceRef="task_buerger_benachrichtigung" targetRef="task_buerger_download" />
    <sequenceFlow id="flow_buerger_10" sourceRef="task_buerger_download" targetRef="end_buerger" />
  </process>

  <!-- Prozess: Einwohnermeldeamt -->
  <process id="process_einwohnermeldeamt" name="Einwohnermeldeamt-Prozess" isExecutable="true">
    <extensionElements>
      <camunda:properties>
        <camunda:property name="variable:sachbearbeiter" value="Identity" />
        <camunda:property name="variable:antrag_vollstaendig" value="Boolean" />
        <camunda:property name="variable:identitaet_korrekt" value="Boolean" />
        <camunda:property name="variable:wohnungsgeber_gueltig" value="Boolean" />
        <camunda:property name="variable:zustaendigkeit_gegeben" value="Boolean" />
        <camunda:property name="variable:bestaetigung_korrekt" value="Boolean" />
      </camunda:properties>
    </extensionElements>

    <startEvent id="start_amt" name="Ummeldungsantrag eingegangen" />
    
    <userTask id="task_amt_empfangen" 
              name="Antrag im Workflow-System empfangen" 
              camunda:candidateUsers="${variables.get('sachbearbeiter')}" 
              camunda:priority="50" />
    
    <userTask id="task_amt_oeffnen" 
              name="Antrag öffnen und formale Vollständigkeit prüfen" 
              camunda:candidateUsers="${variables.get('sachbearbeiter')}" 
              camunda:priority="50" />
    
    <userTask id="task_amt_identitaet" 
              name="Identitätsdaten mit Melderegister abgleichen" 
              camunda:candidateUsers="${variables.get('sachbearbeiter')}" 
              camunda:priority="50" />
    
    <userTask id="task_amt_wohnungsgeber" 
              name="Gültigkeit der Wohnungsgeberbestätigung prüfen" 
              camunda:candidateUsers="${variables.get('sachbearbeiter')}" 
              camunda:priority="50" />
    
    <userTask id="task_amt_zustaendigkeit" 
              name="Zuständigkeit für neue Adresse prüfen" 
              camunda:candidateUsers="${variables.get('sachbearbeiter')}" 
              camunda:priority="50" />
    
    <userTask id="task_amt_eintragen" 
              name="Neue Wohnadresse im Melderegister eintragen" 
              camunda:candidateUsers="${variables.get('sachbearbeiter')}" 
              camunda:priority="50" />
    
    <userTask id="task_amt_generieren" 
              name="Meldebestätigung automatisch generieren" 
              camunda:candidateUsers="${variables.get('sachbearbeiter')}" 
              camunda:priority="50" />
    
    <userTask id="task_amt_pruefen" 
              name="Generierte Meldebestätigung auf Korrektheit prüfen" 
              camunda:candidateUsers="${variables.get('sachbearbeiter')}" 
              camunda:priority="50" />
    
    <userTask id="task_amt_versenden" 
              name="Meldebestätigung per E-Mail versenden und bereitstellen" 
              camunda:candidateUsers="${variables.get('sachbearbeiter')}" 
              camunda:priority="50" />
    
    <endEvent id="end_amt" name="Bearbeitung abgeschlossen" />
    
    <sequenceFlow id="flow_amt_1" sourceRef="start_amt" targetRef="task_amt_empfangen" />
    <sequenceFlow id="flow_amt_2" sourceRef="task_amt_empfangen" targetRef="task_amt_oeffnen" />
    <sequenceFlow id="flow_amt_3" sourceRef="task_amt_oeffnen" targetRef="task_amt_identitaet" />
    <sequenceFlow id="flow_amt_4" sourceRef="task_amt_identitaet" targetRef="task_amt_wohnungsgeber" />
    <sequenceFlow id="flow_amt_5" sourceRef="task_amt_wohnungsgeber" targetRef="task_amt_zustaendigkeit" />
    <sequenceFlow id="flow_amt_6" sourceRef="task_amt_zustaendigkeit" targetRef="task_amt_eintragen" />
    <sequenceFlow id="flow_amt_7" sourceRef="task_amt_eintragen" targetRef="task_amt_generieren" />
    <sequenceFlow id="flow_amt_8" sourceRef="task_amt_generieren" targetRef="task_amt_pruefen" />
    <sequenceFlow id="flow_amt_9" sourceRef="task_amt_pruefen" targetRef="task_amt_versenden" />
    <sequenceFlow id="flow_amt_10" sourceRef="task_amt_versenden" targetRef="end_amt" />
  </process>

  <!-- BPMN-Diagramm -->
  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="collaboration_wohnsitz_ummelden_v2">
      
      <!-- Pool: Bürger -->
      <bpmndi:BPMNShape id="participant_buerger_di" bpmnElement="participant_buerger" isHorizontal="true">
        <dc:Bounds x="120" y="80" width="1920" height="200" />
      </bpmndi:BPMNShape>
      
      <!-- Bürger: Start Event -->
      <bpmndi:BPMNShape id="start_buerger_di" bpmnElement="start_buerger">
        <dc:Bounds x="172" y="162" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="152" y="205" width="76" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      
      <!-- Bürger: Task 1 -->
      <bpmndi:BPMNShape id="task_buerger_portal_di" bpmnElement="task_buerger_portal">
        <dc:Bounds x="260" y="140" width="100" height="80" />
      </bpmndi:BPMNShape>
      
      <!-- Bürger: Task 2 -->
      <bpmndi:BPMNShape id="task_buerger_dienst_di" bpmnElement="task_buerger_dienst">
        <dc:Bounds x="410" y="140" width="100" height="80" />
      </bpmndi:BPMNShape>
      
      <!-- Bürger: Task 3 -->
      <bpmndi:BPMNShape id="task_buerger_adressen_di" bpmnElement="task_buerger_adressen">
        <dc:Bounds x="560" y="140" width="100" height="80" />
      </bpmndi:BPMNShape>
      
      <!-- Bürger: Task 4 -->
      <bpmndi:BPMNShape id="task_buerger_datum_di" bpmnElement="task_buerger_datum">
        <dc:Bounds x="710" y="140" width="100" height="80" />
      </bpmndi:BPMNShape>
      
      <!-- Bürger: Task 5 -->
      <bpmndi:BPMNShape id="task_buerger_upload_di" bpmnElement="task_buerger_upload">
        <dc:Bounds x="860" y="140" width="100" height="80" />
      </bpmndi:BPMNShape>
      
      <!-- Bürger: Task 6 -->
      <bpmndi:BPMNShape id="task_buerger_pruefen_di" bpmnElement="task_buerger_pruefen">
        <dc:Bounds x="1010" y="140" width="100" height="80" />
      </bpmndi:BPMNShape>
      
      <!-- Bürger: Task 7 -->
      <bpmndi:BPMNShape id="task_buerger_absenden_di" bpmnElement="task_buerger_absenden">
        <dc:Bounds x="1160" y="140" width="100" height="80" />
      </bpmndi:BPMNShape>
      
      <!-- Bürger: Task 8 -->
      <bpmndi:BPMNShape id="task_buerger_benachrichtigung_di" bpmnElement="task_buerger_benachrichtigung">
        <dc:Bounds x="1580" y="140" width="100" height="80" />
      </bpmndi:BPMNShape>
      
      <!-- Bürger: Task 9 -->
      <bpmndi:BPMNShape id="task_buerger_download_di" bpmnElement="task_buerger_download">
        <dc:Bounds x="1730" y="140" width="100" height="80" />
      </bpmndi:BPMNShape>
      
      <!-- Bürger: End Event -->
      <bpmndi:BPMNShape id="end_buerger_di" bpmnElement="end_buerger">
        <dc:Bounds x="1882" y="162" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1862" y="205" width="76" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      
      <!-- Pool: Einwohnermeldeamt -->
      <bpmndi:BPMNShape id="participant_einwohnermeldeamt_di" bpmnElement="participant_einwohnermeldeamt" isHorizontal="true">
        <dc:Bounds x="120" y="320" width="1920" height="200" />
      </bpmndi:BPMNShape>
      
      <!-- Amt: Start Event -->
      <bpmndi:BPMNShape id="start_amt_di" bpmnElement="start_amt">
        <dc:Bounds x="172" y="402" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="152" y="445" width="76" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      
      <!-- Amt: Task 1 -->
      <bpmndi:BPMNShape id="task_amt_empfangen_di" bpmnElement="task_amt_empfangen">
        <dc:Bounds x="260" y="380" width="100" height="80" />
      </bpmndi:BPMNShape>
      
      <!-- Amt: Task 2 -->
      <bpmndi:BPMNShape id="task_amt_oeffnen_di" bpmnElement="task_amt_oeffnen">
        <dc:Bounds x="410" y="380" width="100" height="80" />
      </bpmndi:BPMNShape>
      
      <!-- Amt: Task 3 -->
      <bpmndi:BPMNShape id="task_amt_identitaet_di" bpmnElement="task_amt_identitaet">
        <dc:Bounds x="560" y="380" width="100" height="80" />
      </bpmndi:BPMNShape>
      
      <!-- Amt: Task 4 -->
      <bpmndi:BPMNShape id="task_amt_wohnungsgeber_di" bpmnElement="task_amt_wohnungsgeber">
        <dc:Bounds x="710" y="380" width="100" height="80" />
      </bpmndi:BPMNShape>
      
      <!-- Amt: Task 5 -->
      <bpmndi:BPMNShape id="task_amt_zustaendigkeit_di" bpmnElement="task_amt_zustaendigkeit">
        <dc:Bounds x="860" y="380" width="100" height="80" />
      </bpmndi:BPMNShape>
      
      <!-- Amt: Task 6 -->
      <bpmndi:BPMNShape id="task_amt_eintragen_di" bpmnElement="task_amt_eintragen">
        <dc:Bounds x="1010" y="380" width="100" height="80" />
      </bpmndi:BPMNShape>
      
      <!-- Amt: Task 7 -->
      <bpmndi:BPMNShape id="task_amt_generieren_di" bpmnElement="task_amt_generieren">
        <dc:Bounds x="1160" y="380" width="100" height="80" />
      </bpmndi:BPMNShape>
      
      <!-- Amt: Task 8 -->
      <bpmndi:BPMNShape id="task_amt_pruefen_di" bpmnElement="task_amt_pruefen">
        <dc:Bounds x="1310" y="380" width="100" height="80" />
      </bpmndi:BPMNShape>
      
      <!-- Amt: Task 9 -->
      <bpmndi:BPMNShape id="task_amt_versenden_di" bpmnElement="task_amt_versenden">
        <dc:Bounds x="1460" y="380" width="100" height="80" />
      </bpmndi:BPMNShape>
      
      <!-- Amt: End Event -->
      <bpmndi:BPMNShape id="end_amt_di" bpmnElement="end_amt">
        <dc:Bounds x="1612" y="402" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1592" y="445" width="76" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      
      <!-- Bürger: Sequence Flows -->
      <bpmndi:BPMNEdge id="flow_buerger_1_di" bpmnElement="flow_buerger_1">
        <di:waypoint x="208" y="180" />
        <di:waypoint x="260" y="180" />
      </bpmndi:BPMNEdge>
      
      <bpmndi:BPMNEdge id="flow_buerger_2_di" bpmnElement="flow_buerger_2">
        <di:waypoint x="360" y="180" />
        <di:waypoint x="410" y="180" />
      </bpmndi:BPMNEdge>
      
      <bpmndi:BPMNEdge id="flow_buerger_3_di" bpmnElement="flow_buerger_3">
        <di:waypoint x="510" y="180" />
        <di:waypoint x="560" y="180" />
      </bpmndi:BPMNEdge>
      
      <bpmndi:BPMNEdge id="flow_buerger_4_di" bpmnElement="flow_buerger_4">
        <di:waypoint x="660" y="180" />
        <di:waypoint x="710" y="180" />
      </bpmndi:BPMNEdge>
      
      <bpmndi:BPMNEdge id="flow_buerger_5_di" bpmnElement="flow_buerger_5">
        <di:waypoint x="810" y="180" />
        <di:waypoint x="860" y="180" />
      </bpmndi:BPMNEdge>
      
      <bpmndi:BPMNEdge id="flow_buerger_6_di" bpmnElement="flow_buerger_6">
        <di:waypoint x="960" y="180" />
        <di:waypoint x="1010" y="180" />
      </bpmndi:BPMNEdge>
      
      <bpmndi:BPMNEdge id="flow_buerger_7_di" bpmnElement="flow_buerger_7">
        <di:waypoint x="1110" y="180" />
        <di:waypoint x="1160" y="180" />
      </bpmndi:BPMNEdge>
      
      <bpmndi:BPMNEdge id="flow_buerger_8_di" bpmnElement="flow_buerger_8">
        <di:waypoint x="1260" y="180" />
        <di:waypoint x="1580" y="180" />
      </bpmndi:BPMNEdge>
      
      <bpmndi:BPMNEdge id="flow_buerger_9_di" bpmnElement="flow_buerger_9">
        <di:waypoint x="1680" y="180" />
        <di:waypoint x="1730" y="180" />
      </bpmndi:BPMNEdge>
      
      <bpmndi:BPMNEdge id="flow_buerger_10_di" bpmnElement="flow_buerger_10">
        <di:waypoint x="1830" y="180" />
        <di:waypoint x="1882" y="180" />
      </bpmndi:BPMNEdge>
      
      <!-- Amt: Sequence Flows -->
      <bpmndi:BPMNEdge id="flow_amt_1_di" bpmnElement="flow_amt_1">
        <di:waypoint x="208" y="420" />
        <di:waypoint x="260" y="420" />
      </bpmndi:BPMNEdge>
      
      <bpmndi:BPMNEdge id="flow_amt_2_di" bpmnElement="flow_amt_2">
        <di:waypoint x="360" y="420" />
        <di:waypoint x="410" y="420" />
      </bpmndi:BPMNEdge>
      
      <bpmndi:BPMNEdge id="flow_amt_3_di" bpmnElement="flow_amt_3">
        <di:waypoint x="510" y="420" />
        <di:waypoint x="560" y="420" />
      </bpmndi:BPMNEdge>
      
      <bpmndi:BPMNEdge id="flow_amt_4_di" bpmnElement="flow_amt_4">
        <di:waypoint x="660" y="420" />
        <di:waypoint x="710" y="420" />
      </bpmndi:BPMNEdge>
      
      <bpmndi:BPMNEdge id="flow_amt_5_di" bpmnElement="flow_amt_5">
        <di:waypoint x="810" y="420" />
        <di:waypoint x="860" y="420" />
      </bpmndi:BPMNEdge>
      
      <bpmndi:BPMNEdge id="flow_amt_6_di" bpmnElement="flow_amt_6">
        <di:waypoint x="960" y="420" />
        <di:waypoint x="1010" y="420" />
      </bpmndi:BPMNEdge>
      
      <bpmndi:BPMNEdge id="flow_amt_7_di" bpmnElement="flow_amt_7">
        <di:waypoint x="1110" y="420" />
        <di:waypoint x="1160" y="420" />
      </bpmndi:BPMNEdge>
      
      <bpmndi:BPMNEdge id="flow_amt_8_di" bpmnElement="flow_amt_8">
        <di:waypoint x="1260" y="420" />
        <di:waypoint x="1310" y="420" />
      </bpmndi:BPMNEdge>
      
      <bpmndi:BPMNEdge id="flow_amt_9_di" bpmnElement="flow_amt_9">
        <di:waypoint x="1410" y="420" />
        <di:waypoint x="1460" y="420" />
      </bpmndi:BPMNEdge>
      
      <bpmndi:BPMNEdge id="flow_amt_10_di" bpmnElement="flow_amt_10">
        <di:waypoint x="1560" y="420" />
        <di:waypoint x="1612" y="420" />
      </bpmndi:BPMNEdge>
      
      <!-- Message Flows -->
      <bpmndi:BPMNEdge id="message_flow_1_di" bpmnElement="message_flow_1">
        <di:waypoint x="1210" y="220" />
        <di:waypoint x="1210" y="300" />
        <di:waypoint x="310" y="300" />
        <di:waypoint x="310" y="380" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="700" y="266" width="80" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      
      <bpmndi:BPMNEdge id="message_flow_2_di" bpmnElement="message_flow_2">
        <di:waypoint x="1510" y="380" />
        <di:waypoint x="1510" y="300" />
        <di:waypoint x="1630" y="300" />
        <di:waypoint x="1630" y="220" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1535" y="266" width="70" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</definitions>
